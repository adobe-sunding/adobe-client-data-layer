!function(){"use strict";var r="datalayer:change",n="datalayer:event",i="datalayer:ready";function t(e){this._config=e,this._initialize()}t.prototype._initialize=function(){var e=this;Array.isArray(e._config.dataLayer)||(e._config.dataLayer=[]),e._dataLayer=e._config.dataLayer,e._state={},e._listeners=[],e._dataLayer.getState=function(){return JSON.parse(JSON.stringify(e._state))},e._handleItemsBeforeScriptLoad(e._dataLayer),e._overridePush(),e._triggerListeners({event:i},i)},t.prototype._handleItemsBeforeScriptLoad=function(){var r=this;r._dataLayer.forEach(function(e,t){r._isListener(e)&&r._dataLayer.splice(t,1),r._handleItem(e)})},t.prototype._overridePush=function(){var i=this;i._dataLayer.push=function(e){var r=arguments,n=arguments;if(Object.keys(r).forEach(function(e){var t=r[e];i._handleItem(t),i._isListener(t)&&delete n[e]}),n[0])return Array.prototype.push.apply(this,n)}},t.prototype._handleItem=function(e){e&&(this._isListener(e)?e.on?this._registerListener(e):e.off&&this._unregisterListener(e):(e.data&&(this._updateState(e),this._triggerListeners(e,r)),e.event&&this._triggerListeners(e,n)))},t.prototype._updateState=function(e){t.utils.deepMerge(this.state,e.data)},t.prototype._triggerListeners=function(r,n){console.debug("event triggered -",n),this._listeners.forEach(function(e){if(e.on===n||e.on===r.event){var t=JSON.parse(JSON.stringify(r));r.event&&(t.name=r.event),e.handler(t)}})},t.prototype._triggerListener=function(t){this.dataLayer.forEach(function(e){t.on!==i&&t.on!==r&&t.on!==n&&t.on!==e.event||t.handler(e)})},t.prototype._registerListener=function(e){0===this._getListenerIndexes(e).length&&(this._listeners.push(e),console.debug("listener registered on -",e.on))},t.prototype._unregisterListener=function(e){var t=JSON.parse(JSON.stringify(e));t.on=e.off,delete t.off;for(var r=this._getListenerIndexes(t),n=0;n<r.length;n++)-1<r[n]&&(this._listeners.splice(r[n],1),console.debug("listener unregistered on -",t.on))},t.prototype._getListenerIndexes=function(e){for(var t=[],r=0;r<this._listeners.length;r++){var n=this._listeners[r];if(e.on!==n.on);else{if(e.handler&&e.handler.toString()!==n.handler.toString())continue;t.push(r)}}return t},t.prototype._isListener=function(e){return!!(e.on&&e.handler||e.off)},(t.utils={}).deepMerge=function(t,r){var n={},i=this;i.isObject(t)&&i.isObject(r)&&Object.keys(r).forEach(function(e){i.isObject(r[e])?(t[e]||(n[e]={},Object.assign(t,n)),i.deepMerge(t[e],r[e])):void 0===r[e]?delete t[e]:(n[e]=r[e],Object.assign(t,n))})},t.utils.isObject=function(e){return e&&"object"==typeof e&&!Array.isArray(e)},new t({dataLayer:dataLayer})}();