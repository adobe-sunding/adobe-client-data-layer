!function(){"use strict";var n="datalayer:change",r="datalayer:event",i="datalayer:ready";function t(e){this._config=e,this._initialize()}t.prototype._initialize=function(){var e=this;Array.isArray(e._config.dataLayer)||(e._config.dataLayer=[]),e._dataLayer=e._config.dataLayer,e._state={},e._listeners=[],e._augment(),e._handleItemsBeforeScriptLoad(e._dataLayer),e._triggerListeners({event:i},i)},t.prototype._augment=function(){var i=this;i._dataLayer.push=function(e){var n=arguments,r=arguments;if(Object.keys(n).forEach(function(e){var t=n[e];i._handleItem(t),i._isListener(t)&&delete r[e]}),r[0])return Array.prototype.push.apply(this,r)},i._dataLayer.getState=function(){return JSON.parse(JSON.stringify(i._state))}},t.prototype._handleItemsBeforeScriptLoad=function(){var n=this;n._dataLayer.forEach(function(e,t){n._isListener(e)&&n._dataLayer.splice(t,1),n._handleItem(e)})},t.prototype._handleItem=function(e){e&&(this._isListener(e)?e.on?this._registerListener(e):e.off&&this._unregisterListener(e):(e.data&&(this._updateState(e),this._triggerListeners(e,n)),e.event&&this._triggerListeners(e,r)))},t.prototype._updateState=function(e){t.utils.deepMerge(this.state,e.data)},t.prototype._triggerListeners=function(n,r){console.debug("event triggered -",r),this._listeners.forEach(function(e){if(e.on===r||e.on===n.event){var t=JSON.parse(JSON.stringify(n));n.event&&(t.name=n.event),e.handler(t)}})},t.prototype._triggerListener=function(t){this.dataLayer.forEach(function(e){t.on!==i&&t.on!==n&&t.on!==r&&t.on!==e.event||t.handler(e)})},t.prototype._registerListener=function(e){0===this._getListenerIndexes(e).length&&(this._listeners.push(e),console.debug("listener registered on -",e.on))},t.prototype._unregisterListener=function(e){var t=JSON.parse(JSON.stringify(e));t.on=e.off,delete t.off;for(var n=this._getListenerIndexes(t),r=0;r<n.length;r++)-1<n[r]&&(this._listeners.splice(n[r],1),console.debug("listener unregistered on -",t.on))},t.prototype._getListenerIndexes=function(e){for(var t=[],n=0;n<this._listeners.length;n++){var r=this._listeners[n];if(e.on!==r.on);else{if(e.handler&&e.handler.toString()!==r.handler.toString())continue;t.push(n)}}return t},t.prototype._isListener=function(e){return!!(e.on&&e.handler||e.off)},(t.utils={}).deepMerge=function(t,n){var r={},i=this;i.isObject(t)&&i.isObject(n)&&Object.keys(n).forEach(function(e){i.isObject(n[e])?(t[e]||(r[e]={},Object.assign(t,r)),i.deepMerge(t[e],n[e])):void 0===n[e]?delete t[e]:(r[e]=n[e],Object.assign(t,r))})},t.utils.isObject=function(e){return e&&"object"==typeof e&&!Array.isArray(e)},new t({dataLayer:window.dataLayer})}();