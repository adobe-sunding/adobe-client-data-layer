!function(){"use strict";var e={},t="datalayer:change",n="datalayer:event",i="datalayer:ready";e.Manager=function(e){this._config=e,this._initialize()},e.Manager.prototype._initialize=function(){Array.isArray(this._config.dataLayer)||(this._config.dataLayer=[]),this._dataLayer=this._config.dataLayer,this._state={},this._listeners=[],this._augment(),this._processItems(),this._triggerListeners({event:i},i)},e.Manager.prototype._augment=function(){var t=this;t._dataLayer.push=function(n){var i=arguments,r=arguments;if(Object.keys(i).forEach((function(n){var s=i[n],a=new e.Item(s);t._processItem(a),a.utils.isListenerConfig(a.getConfig())&&delete r[n]})),r[0])return Array.prototype.push.apply(this,r)},t._dataLayer.getState=function(){return JSON.parse(JSON.stringify(t._state))}},e.Manager.prototype._processItems=function(){for(var t=0;t<this._dataLayer.length;t++){var n=new e.Item(this._dataLayer[t]);this._processItem(n),n.utils.isListenerConfig(n.getConfig())&&(this._dataLayer.splice(t,1),t--)}},e.Manager.prototype._processItem=function(e){var n=this;if(e.isValid()){({data:function(e){n._updateState(e),n._triggerListeners(e.getConfig(),t)},event:function(e){n._triggerListeners(e),e.getConfig().data&&(n._updateState(e),n._triggerListeners(e.getConfig(),t))},listenerOn:function(e){n._registerListener(e.getConfig())},listenerOff:function(e){n._unregisterListener(e.getConfig())}})[e.getType()](e)}else{var i="The following item cannot be handled by the data layer because it does not have a valid format: "+JSON.stringify(e);console.error(i)}},e.Manager.prototype._updateState=function(t){e.utils.deepMerge(this.state,t.data)},e.Manager.prototype._triggerListeners=function(e,t){console.debug("event triggered -",t),this._listeners.forEach((function(n){if(n.on===t||n.on===e.event){var i=JSON.parse(JSON.stringify(e));e.event&&(i.name=e.event),n.handler(i)}}))},e.Manager.prototype._triggerListener=function(e){this.dataLayer.forEach((function(r){e.on!==i&&e.on!==t&&e.on!==n&&e.on!==r.event||e.handler(r)}))},e.Manager.prototype._registerListener=function(e){0===this._getListenerIndexes(e).length&&(this._listeners.push(e),console.debug("listener registered on -",e.on))},e.Manager.prototype._unregisterListener=function(e){var t=JSON.parse(JSON.stringify(e));t.on=e.off,delete t.off;for(var n=this._getListenerIndexes(t),i=0;i<n.length;i++)n[i]>-1&&(this._listeners.splice(n[i],1),console.debug("listener unregistered on -",t.on))},e.Manager.prototype._getListenerIndexes=function(e){for(var t=[],n=0;n<this._listeners.length;n++){var i=this._listeners[n];if(e.on!==i.on);else{if(e.handler&&e.handler.toString()!==i.handler.toString())continue;t.push(n)}}return t};var r="data",s="event",a="listenerOn",o="listenerOff";e.Item=function(e){var t,n,i=this;i._config=e,i._type=(t=e,i.utils.isDataConfig(t)?n=r:i.utils.isEventConfig(t)?n=s:i.utils.isListenerOnConfig(t)?n=a:i.utils.isListenerOffConfig(t)&&(n=o),n),i._valid=!!i._type},e.Item.prototype.isValid=function(){return this._valid},e.Item.prototype.getType=function(){return this._type},e.Item.prototype.getConfig=function(){return this._config},e.Item.prototype.utils={isDataConfig:function(e){return!!e&&(1===Object.keys(e).length&&e.data)},isEventConfig:function(e){return!!e&&(1===Object.keys(e).length&&e.event||2===Object.keys(e).length&&e.event&&e.info||2===Object.keys(e).length&&e.event&&e.data||3===Object.keys(e).length&&e.event&&e.info&&e.data)},isListenerConfig:function(e){return this.isListenerOnConfig(e)||this.isListenerOffConfig(e)},isListenerOnConfig:function(e){return!!e&&(2===Object.keys(e).length&&e.on&&e.handler||3===Object.keys(e).length&&e.on&&e.handler&&e.scope||3===Object.keys(e).length&&e.on&&e.handler&&e.selector||4===Object.keys(e).length&&e.on&&e.handler&&e.scope&&e.selector)},isListenerOffConfig:function(e){return!!e&&(1===Object.keys(e).length&&e.off||2===Object.keys(e).length&&e.off&&e.handler||3===Object.keys(e).length&&e.off&&e.handler&&e.scope||3===Object.keys(e).length&&e.off&&e.handler&&e.selector||4===Object.keys(e).length&&e.off&&e.handler&&e.scope&&e.selector)}},e.utils={},e.utils.deepMerge=function(e,t){var n={},i=this;i.isObject(e)&&i.isObject(t)&&Object.keys(t).forEach((function(r){i.isObject(t[r])?(e[r]||(n[r]={},Object.assign(e,n)),i.deepMerge(e[r],t[r])):void 0===t[r]?delete e[r]:(n[r]=t[r],Object.assign(e,n))}))},e.utils.isObject=function(e){return e&&"object"==typeof e&&!Array.isArray(e)},new e.Manager({dataLayer:window.dataLayer})}();