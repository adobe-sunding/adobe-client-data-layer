!function(){"use strict";var t={},n="datalayer:change",r="datalayer:event",s="datalayer:ready";t.Manager=function(e){this._config=e,this._initialize()},t.Manager.prototype._initialize=function(){var e=this;Array.isArray(e._config.dataLayer)||(e._config.dataLayer=[]),e._dataLayer=e._config.dataLayer,e._state={},e._listeners=[],e._augment(),e._processItems(),e._triggerListeners({event:s},s)},t.Manager.prototype._augment=function(){var s=this;s._dataLayer.push=function(e){var n=arguments,r=arguments;if(Object.keys(n).forEach(function(e){var t=n[e];s._processItem(t),s._isListener(t)&&delete r[e]}),r[0])return Array.prototype.push.apply(this,r)},s._dataLayer.getState=function(){return JSON.parse(JSON.stringify(s._state))}},t.Manager.prototype._processItems=function(){for(var e=0;e<this._dataLayer.length;e++){var t=this._dataLayer[e];this._processItem(t),this._isListener(t)&&(this._dataLayer.splice(e,1),e--)}},t.Manager.prototype._processItem=function(e){if(e)if(this._isData(e))this._updateState(e),this._triggerListeners(e,n);else if(this._isEvent(e))this._triggerListeners(e,r),this._isEventWithData(e)&&(this._updateState(e),this._triggerListeners(e,n));else if(this._isListenerOn(e))this._registerListener(e);else if(this._isListenerOff(e))this._unregisterListener(e);else{var t="The following item cannot be handled by the data layer because it does not have a valid format: "+JSON.stringify(e);console.error(t)}},t.Manager.prototype._updateState=function(e){t.utils.deepMerge(this.state,e.data)},t.Manager.prototype._triggerListeners=function(n,r){console.debug("event triggered -",r),this._listeners.forEach(function(e){if(e.on===r||e.on===n.event){var t=JSON.parse(JSON.stringify(n));n.event&&(t.name=n.event),e.handler(t)}})},t.Manager.prototype._triggerListener=function(t){this.dataLayer.forEach(function(e){t.on!==s&&t.on!==n&&t.on!==r&&t.on!==e.event||t.handler(e)})},t.Manager.prototype._registerListener=function(e){0===this._getListenerIndexes(e).length&&(this._listeners.push(e),console.debug("listener registered on -",e.on))},t.Manager.prototype._unregisterListener=function(e){var t=JSON.parse(JSON.stringify(e));t.on=e.off,delete t.off;for(var n=this._getListenerIndexes(t),r=0;r<n.length;r++)-1<n[r]&&(this._listeners.splice(n[r],1),console.debug("listener unregistered on -",t.on))},t.Manager.prototype._getListenerIndexes=function(e){for(var t=[],n=0;n<this._listeners.length;n++){var r=this._listeners[n];if(e.on!==r.on);else{if(e.handler&&e.handler.toString()!==r.handler.toString())continue;t.push(n)}}return t},t.Manager.prototype._isData=function(e){return!!e&&(1===Object.keys(e).length&&e.data)},t.Manager.prototype._isEvent=function(e){return!!e&&(1===Object.keys(e).length&&e.event||2===Object.keys(e).length&&e.event&&e.info||2===Object.keys(e).length&&e.event&&e.data||3===Object.keys(e).length&&e.event&&e.info&&e.data)},t.Manager.prototype._isEventWithData=function(e){return this._isEvent(e)&&e.data},t.Manager.prototype._isListener=function(e){return this._isListenerOn(e)||this._isListenerOff(e)},t.Manager.prototype._isListenerOn=function(e){return!!e&&(2===Object.keys(e).length&&e.on&&e.handler||3===Object.keys(e).length&&e.on&&e.handler&&e.scope||3===Object.keys(e).length&&e.on&&e.handler&&e.selector||4===Object.keys(e).length&&e.on&&e.handler&&e.scope&&e.selector)},t.Manager.prototype._isListenerOff=function(e){return!!e&&(1===Object.keys(e).length&&e.off||2===Object.keys(e).length&&e.off&&e.handler||3===Object.keys(e).length&&e.off&&e.handler&&e.scope||3===Object.keys(e).length&&e.off&&e.handler&&e.selector||4===Object.keys(e).length&&e.off&&e.handler&&e.scope&&e.selector)},t.utils={},t.utils.deepMerge=function(t,n){var r={},s=this;s.isObject(t)&&s.isObject(n)&&Object.keys(n).forEach(function(e){s.isObject(n[e])?(t[e]||(r[e]={},Object.assign(t,r)),s.deepMerge(t[e],n[e])):void 0===n[e]?delete t[e]:(r[e]=n[e],Object.assign(t,r))})},t.utils.isObject=function(e){return e&&"object"==typeof e&&!Array.isArray(e)},new t.Manager({dataLayer:window.dataLayer})}();