!function(){"use strict";var n="datalayer:change",r="datalayer:event",t="datalayer:ready";function i(e){var t=this;t.dataLayer=e,t.state={},t._listeners=[],t.dataLayer.getState=function(){return JSON.parse(JSON.stringify(t.state))},t._init()}i.prototype._init=function(){this._handleItemsBeforeScriptLoad(this.dataLayer),this._overridePush()},i.prototype._handleItemsBeforeScriptLoad=function(){var n=this;this.dataLayer.forEach(function(e,t){n._isListener(e)&&n.dataLayer.splice(t,1),n._handleItem(e)})},i.prototype._overridePush=function(){var i=this;i.dataLayer.push=function(e){var n=arguments,r=arguments;if(Object.keys(n).forEach(function(e){var t=n[e];i._handleItem(t),i._isListener(t)&&delete r[e]}),r[0])return Array.prototype.push.apply(this,r)}},i.prototype._handleItem=function(e){e&&(this._isListener(e)?e.on?this._registerListener(e):e.off&&this._unregisterListener(e):(e.data&&(this._updateState(e),this._triggerListeners(e,n)),e.event&&this._triggerListeners(e,r)))},i.prototype._updateState=function(e){i.utils.deepMerge(this.state,e.data)},i.prototype._triggerListeners=function(n,r){this._listeners.forEach(function(e){if(e.on===r||e.on===n.event){var t=JSON.parse(JSON.stringify(n));n.event&&(t.name=n.event),e.handler(t)}})},i.prototype._triggerListener=function(t){this.dataLayer.forEach(function(e){t.on!==n&&t.on!==r&&t.on!==e.event||t.handler(e)})},i.prototype._registerListener=function(e){0===this._getListenerIndexes(e).length&&(this._listeners.push(e),console.log("event listener registered on: ",e.on))},i.prototype._unregisterListener=function(e){var t=JSON.parse(JSON.stringify(e));t.on=e.off,delete t.off;for(var n=this._getListenerIndexes(t),r=0;r<n.length;r++)-1<n[r]&&(this._listeners.splice(n[r],1),console.log("event listener unregistered on: ",t.on))},i.prototype._getListenerIndexes=function(e){for(var t=[],n=0;n<this._listeners.length;n++){var r=this._listeners[n];if(e.on!==r.on);else{if(e.handler&&e.handler.toString()!==r.handler.toString())continue;t.push(n)}}return t},i.prototype._isListener=function(e){return!!(e.on&&e.handler||e.off)},(i.utils={}).deepMerge=function(t,n){var r={},i=this;i.isObject(t)&&i.isObject(n)&&Object.keys(n).forEach(function(e){i.isObject(n[e])?(t[e]||(r[e]={},Object.assign(t,r)),i.deepMerge(t[e],n[e])):void 0===n[e]?delete t[e]:(r[e]=n[e],Object.assign(t,r))})},i.utils.isObject=function(e){return e&&"object"==typeof e&&!Array.isArray(e)},window.addEventListener("datalayer:prepopulated",function(){console.log("data layer prepopulated - let's initialize the data layer"),window.dataLayer=window.dataLayer||[],new i(window.dataLayer);var e=new CustomEvent(t);window.dispatchEvent(e),console.log("datalayer:ready")})}();